{% extends 'base_table.html' %}
{% load tz %}

{% block page_title %}
  Gestión | Estudiantes del Examen
{% endblock %}

{% block back_button %}
  <a href="{% url 'exams_table' %}" class="inline-flex items-center text-indigo-600"><i class="fas fa-arrow-left mr-2"></i><span class="hover:underline">Regresar</span></a>
{% endblock %}

{% block crud_title %}
  Intentos en
{% endblock %} {% block crud_badge %}
  {{ exam.title }}
{% endblock %}

{% block table_header %}
  <tr class="text-gray-800 text-sm">
    <th class="px-4 py-2">#</th>
    <th class="px-4 py-2">Nombre</th>
    <th class="px-4 py-2">Documento</th>
    <th class="px-4 py-2">Correo electrónico</th>
    <th class="px-4 py-2">Intentos</th>
    <th class="px-4 py-2">% de Aciertos</th>
    <th class="px-4 py-2">Acciones</th>
  </tr>
{% endblock %}

{% block table_body %}
  {% for data in page_obj %}
    <tr class="text-center">
      <td class="px-4 py-2">{{ forloop.counter }}</td>
      <td class="px-4 py-2 text-left">{{ data.student }}</td>
      <td class="px-4 py-2">{{ data.student.document_number }}</td>
      <td class="px-4 py-2 text-blue-500 underline">{{ data.student.email }}</td>
      <td class="px-4 py-2">{{ data.total_attempts|length }} / {{ exam.max_attempts }}</td>
      <td class="px-4 py-2">
        {% if data.average_score <= 40 %}
          <span class="inline-block px-2 py-1 rounded-full bg-red-500 border-red-600 border shadow-md text-white text-xs">{{ data.average_score|floatformat:2 }} %</span>
        {% elif data.average_score >= 50 and data.average_score <= 60 %}
          <span class="inline-block px-2 py-1 rounded-full bg-yellow-500 border-yellow-600 border shadow-md text-white text-xs">{{ data.average_score|floatformat:2 }} %</span>
        {% elif data.average_score > 60 %}
          <span class="inline-block px-2 py-1 rounded-full bg-green-500 border-green-600 border shadow-md text-white text-xs">{{ data.average_score|floatformat:2 }} %</span>
        {% else %}
          <span class="inline-block px-2 py-1 rounded-full bg-gray-500 border-gray-600 border shadow-md text-white text-xs">{{ data.average_score|floatformat:2 }} %</span>
        {% endif %}
      </td>
      <td class="px-10 py-2 align-top">
        <a href="{% url 'my_attempts' data.student.id exam.id %}" class="inline-flex items-center px-3 py-3 bg-indigo-600 text-white rounded-md hover:bg-indigo-700"><i class="fas fa-eye"></i></a>
      </td>
    </tr>
  {% empty %}
    <tr>
      <td colspan="6" class="px-4 py-2 text-center text-gray-600">No hay estudiantes inscritos en este examen.</td>
    </tr>
  {% endfor %}
{% endblock %}
